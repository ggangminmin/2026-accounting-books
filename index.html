<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="íšŒê³„ê´€ë¦¬">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <title>2026 íšŒê³„ ê´€ë¦¬ V2</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Poppins', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: inherit;
      touch-action: manipulation;
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }

    .card {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 16px;
    }

    .input-field {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s;
      font-family: inherit;
    }

    .input-field:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }

    .modal {
      background: white;
      border-radius: 24px;
      padding: 24px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .number-display {
      font-family: 'Orbitron', monospace;
      font-weight: 700;
    }

    textarea {
      resize: vertical;
      font-family: inherit;
    }

    select {
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .btn {
        padding: 10px 16px;
        font-size: 14px;
      }

      .card {
        padding: 16px;
      }

      h1 {
        font-size: 24px !important;
      }
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .month-item {
      padding: 12px;
      background: #f9fafb;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .receipt-preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 8px;
      margin-top: 12px;
    }

    .receipt-preview-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid #e5e7eb;
    }

    .receipt-preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .receipt-remove-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(239, 68, 68, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Supabase ì´ˆê¸°í™”
    const SUPABASE_URL = 'https://albrnqpfwnykdlpvvliw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFsYnJucXBmd255a2RscHZ2bGl3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1NjE4NTQsImV4cCI6MjA4MzEzNzg1NH0.jIkx_poj0l6MBv074Bbc3AgIgaggMwyXGKb63_X38V4';
    const supabaseClient = window.supabase?.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const Icon = ({ type, size = 20 }) => {
      const icons = {
        plus: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
        download: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>,
        upload: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>,
        trash: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
        eye: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>,
        image: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>,
        x: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
        users: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
      };
      return icons[type] || null;
    };

    const AccountingApp = () => {
      // ì´ˆê¸° ì˜ˆì‚° ì„¤ì • (ê° í•­ëª©ë³„ ë…ë¦½ì  ê´€ë¦¬)
      const INITIAL_GENERAL_BUDGET = 3200000;  // ì¼ë°˜ ì˜ˆì‚° ì´ˆê¸°ê°’
      const INITIAL_DONATIONS = 11133;         // ì°¬ì¡°ê¸ˆ ì´ˆê¸°ê°’
      const INITIAL_MEMBERSHIP = 496000;       // íšŒë¹„ ì´ˆê¸°ê°’

      // ë…ë¦½ì  ì”ì•¡ State
      const [generalBudget, setGeneralBudget] = useState(INITIAL_GENERAL_BUDGET);
      const [donations, setDonations] = useState(INITIAL_DONATIONS);
      const [membershipFee, setMembershipFee] = useState(INITIAL_MEMBERSHIP);

      const [expenses, setExpenses] = useState([]);
      const [membershipList, setMembershipList] = useState([]);
      const [donationsList, setDonationsList] = useState([]);
      const [showAddForm, setShowAddForm] = useState(false);
      const [showMembershipForm, setShowMembershipForm] = useState(false);
      const [showDonationsForm, setShowDonationsForm] = useState(false);
      const [editingExpense, setEditingExpense] = useState(null);
      const [viewMode, setViewMode] = useState('dashboard');
      const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth() + 1);
      const [viewingReceipt, setViewingReceipt] = useState(null);

      const [formData, setFormData] = useState({
        date: new Date().toISOString().split('T')[0],
        amount: '',
        category: 'ì°¬ì–‘íŒ€ ì‹ì‚¬',
        memo: '',
        account: 'ì¼ë°˜ ì˜ˆì‚°',
        receipts: []
      });

      const [membershipFormData, setMembershipFormData] = useState({
        date: new Date().toISOString().split('T')[0],
        name: '',
        amount: '',
        memo: ''
      });

      const [donationsFormData, setDonationsFormData] = useState({
        date: new Date().toISOString().split('T')[0],
        name: '',
        amount: '',
        memo: ''
      });

      // ìˆ«ìë¥¼ ì‰¼í‘œ í¬ë§·ìœ¼ë¡œ ë³€í™˜
      const formatNumber = (num) => {
        if (!num && num !== 0) return '';
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      };

      // ì‰¼í‘œê°€ í¬í•¨ëœ ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜
      const parseNumber = (str) => {
        if (!str) return '';
        return str.replace(/,/g, '');
      };

      // ============ Supabase í•¨ìˆ˜ë“¤ ============

      // Supabaseì—ì„œ ë°ì´í„° ë¡œë“œ
      const loadFromSupabase = async () => {
        try {
          const { data: expensesData, error: expensesError } = await supabaseClient
            .from('expenses')
            .select('*')
            .order('date', { ascending: false });

          if (expensesError) throw expensesError;

          const { data: settingsData, error: settingsError } = await supabaseClient
            .from('settings')
            .select('*');

          if (settingsError) throw settingsError;

          if (expensesData) {
            setExpenses(expensesData.map(exp => ({
              ...exp,
              receipts: exp.receipts || []
            })));
          }

          let generalBudgetItem, donationsItem, membershipItem;

          if (settingsData) {
            generalBudgetItem = settingsData.find(s => s.key === 'general_budget');
            donationsItem = settingsData.find(s => s.key === 'donations');
            membershipItem = settingsData.find(s => s.key === 'membership_fee');

            if (generalBudgetItem) setGeneralBudget(generalBudgetItem.value);
            if (donationsItem) setDonations(donationsItem.value);
            if (membershipItem) setMembershipFee(membershipItem.value);
          }

          console.log('âœ… Supabase ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', {
            ì¼ë°˜ì˜ˆì‚°: generalBudgetItem?.value || INITIAL_GENERAL_BUDGET,
            íšŒë¹„: membershipItem?.value || INITIAL_MEMBERSHIP,
            ì°¬ì¡°ê¸ˆ: donationsItem?.value || INITIAL_DONATIONS
          });
        } catch (error) {
          console.error('âŒ Supabase ë¡œë“œ ì‹¤íŒ¨:', error);
        }
      };

      // Supabaseì— ì§€ì¶œ ì €ì¥
      const saveExpenseToSupabase = async (expense) => {
        try {
          console.log('ğŸ“¤ ì§€ì¶œ ë°ì´í„° ì „ì†¡ ì‹œë„:', {
            id: expense.id,
            date: expense.date,
            amount: expense.amount,
            category: expense.category,
            account: expense.account,
            receiptsCount: expense.receipts?.length || 0
          });

          const { data, error } = await supabaseClient
            .from('expenses')
            .insert([{
              id: expense.id,
              date: expense.date,
              amount: expense.amount,
              category: expense.category,
              memo: expense.memo,
              account: expense.account,
              receipts: expense.receipts || []
            }]);

          if (error) {
            console.error('âŒ Supabase ì—ëŸ¬ ìƒì„¸:', {
              message: error.message,
              details: error.details,
              hint: error.hint,
              code: error.code
            });
            throw error;
          }
          console.log('âœ… ì§€ì¶œ ì €ì¥ ì™„ë£Œ:', expense.id);
        } catch (error) {
          console.error('âŒ ì§€ì¶œ ì €ì¥ ì‹¤íŒ¨ (catch):', error);
          alert(`ì €ì¥ ì‹¤íŒ¨: ${error.message}\n\në°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ í™•ì¸í•˜ì„¸ìš”. migration.sqlì„ Supabaseì—ì„œ ì‹¤í–‰í–ˆë‚˜ìš”?`);
          throw error;
        }
      };

      // Supabaseì—ì„œ ì§€ì¶œ ì‚­ì œ
      const deleteExpenseFromSupabase = async (id) => {
        try {
          const { error } = await supabaseClient
            .from('expenses')
            .delete()
            .eq('id', id);

          if (error) throw error;
          console.log('âœ… ì§€ì¶œ ì‚­ì œ ì™„ë£Œ:', id);
        } catch (error) {
          console.error('âŒ ì§€ì¶œ ì‚­ì œ ì‹¤íŒ¨:', error);
          throw error;
        }
      };

      // Supabaseì—ì„œ ì§€ì¶œ ì—…ë°ì´íŠ¸
      const updateExpenseInSupabase = async (expense) => {
        try {
          const { error } = await supabaseClient
            .from('expenses')
            .update({
              date: expense.date,
              amount: expense.amount,
              category: expense.category,
              memo: expense.memo,
              account: expense.account,
              receipts: expense.receipts || []
            })
            .eq('id', expense.id);

          if (error) throw error;
          console.log('âœ… ì§€ì¶œ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', expense.id);
        } catch (error) {
          console.error('âŒ ì§€ì¶œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
          throw error;
        }
      };

      // Supabaseì— ì„¤ì • ì—…ë°ì´íŠ¸
      const updateSettingInSupabase = async (key, value) => {
        try {
          console.log('ğŸ“¤ ì„¤ì • ì—…ë°ì´íŠ¸ ì‹œë„:', { key, value });

          const { error } = await supabaseClient
            .from('settings')
            .update({ value: value })
            .eq('key', key);

          if (error) {
            console.error('âŒ Supabase ì„¤ì • ì—ëŸ¬:', {
              message: error.message,
              details: error.details,
              hint: error.hint,
              code: error.code
            });
            throw error;
          }
          console.log('âœ… ì„¤ì • ì—…ë°ì´íŠ¸ ì™„ë£Œ:', key, 'â†’', value);
        } catch (error) {
          console.error('âŒ ì„¤ì • ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ (catch):', error);
        }
      };

      // Supabase Storageì— ì˜ìˆ˜ì¦ ì—…ë¡œë“œ
      const uploadReceiptToSupabase = async (id, dataUrl, index) => {
        try {
          const response = await fetch(dataUrl);
          const blob = await response.blob();

          const fileName = `${id}_${index}.jpg`;
          const { data, error } = await supabaseClient.storage
            .from('receipts')
            .upload(fileName, blob, {
              contentType: 'image/jpeg',
              upsert: true
            });

          if (error) throw error;
          console.log('âœ… ì˜ìˆ˜ì¦ ì—…ë¡œë“œ ì™„ë£Œ:', fileName);
          return fileName;
        } catch (error) {
          console.error('âŒ ì˜ìˆ˜ì¦ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
          throw error;
        }
      };

      // Supabase Storageì—ì„œ ì˜ìˆ˜ì¦ URL ê°€ì ¸ì˜¤ê¸°
      const getReceiptUrlFromSupabase = (fileName) => {
        const { data } = supabaseClient.storage
          .from('receipts')
          .getPublicUrl(fileName);

        return data.publicUrl;
      };

      // Supabase Storageì—ì„œ ì˜ìˆ˜ì¦ ì‚­ì œ
      const deleteReceiptFromSupabase = async (fileName) => {
        try {
          const { error } = await supabaseClient.storage
            .from('receipts')
            .remove([fileName]);

          if (error) throw error;
          console.log('âœ… ì˜ìˆ˜ì¦ ì‚­ì œ ì™„ë£Œ:', fileName);
        } catch (error) {
          console.error('âŒ ì˜ìˆ˜ì¦ ì‚­ì œ ì‹¤íŒ¨:', error);
        }
      };

      useEffect(() => {
        loadFromSupabase();

        const saved = localStorage.getItem('accounting_2026_v2');

        if (saved) {
          const data = JSON.parse(saved);
          setExpenses(data.expenses || []);
          setGeneralBudget(data.generalBudget || INITIAL_GENERAL_BUDGET);
          setDonations(data.donations || INITIAL_DONATIONS);
          setMembershipFee(data.membershipFee || INITIAL_MEMBERSHIP);
          setMembershipList(data.membershipList || []);
          setDonationsList(data.donationsList || []);
        }
      }, []);

      useEffect(() => {
        if (expenses.length > 0 || generalBudget !== INITIAL_GENERAL_BUDGET || donations !== INITIAL_DONATIONS || membershipFee !== INITIAL_MEMBERSHIP) {
          try {
            const dataStr = JSON.stringify({
              expenses,
              generalBudget,
              donations,
              membershipFee,
              membershipList,
              donationsList
            });

            localStorage.setItem('accounting_2026_v2', dataStr);
          } catch (e) {
            console.error('ì €ì¥ ì˜¤ë¥˜:', e);
          }
        }
      }, [expenses, generalBudget, donations, membershipFee, membershipList, donationsList]);

      const handleImageUpload = (e) => {
        const files = Array.from(e.target.files);
        if (files.length + formData.receipts.length > 5) {
          alert('ì˜ìˆ˜ì¦ì€ ìµœëŒ€ 5ì¥ê¹Œì§€ ì²¨ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
          return;
        }

        files.forEach(file => {
          if (file.size > 10 * 1024 * 1024) {
            alert('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. 10MB ì´í•˜ì˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
          }

          const reader = new FileReader();
          reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              let width = img.width;
              let height = img.height;

              const maxSize = 1200;
              if (width > height && width > maxSize) {
                height = (height * maxSize) / width;
                width = maxSize;
              } else if (height > maxSize) {
                width = (width * maxSize) / height;
                height = maxSize;
              }

              canvas.width = width;
              canvas.height = height;

              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0, width, height);

              const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.8);

              setFormData(prev => ({
                ...prev,
                receipts: [...prev.receipts, compressedDataUrl]
              }));
            };
            img.src = event.target.result;
          };
          reader.readAsDataURL(file);
        });
      };

      const removeReceipt = (index) => {
        setFormData(prev => ({
          ...prev,
          receipts: prev.receipts.filter((_, i) => i !== index)
        }));
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        try {
          const expenseId = Date.now();
          const receiptFileNames = [];

          // ì˜ìˆ˜ì¦ ì—…ë¡œë“œ
          for (let i = 0; i < formData.receipts.length; i++) {
            const fileName = await uploadReceiptToSupabase(expenseId, formData.receipts[i], i);
            receiptFileNames.push(fileName);
          }

          const newExpense = {
            id: expenseId,
            date: formData.date,
            amount: parseInt(formData.amount),
            category: formData.category,
            memo: formData.memo,
            account: formData.account,
            receipts: receiptFileNames
          };

          console.log('ğŸ’° ì§€ì¶œ ì¶”ê°€:', {
            ì¶œì²˜: formData.account,
            ê¸ˆì•¡: parseInt(formData.amount)
          });

          // ì¶œì²˜ì— ë”°ë¼ í•´ë‹¹ í•­ëª©ì—ì„œë§Œ ì°¨ê° (ë…ë¦½ì  ê´€ë¦¬)
          if (formData.account === 'ì¼ë°˜ ì˜ˆì‚°') {
            const newGeneralBudget = generalBudget - parseInt(formData.amount);
            setGeneralBudget(newGeneralBudget);
            updateSettingInSupabase('general_budget', newGeneralBudget);
            console.log('âœ… ì¼ë°˜ ì˜ˆì‚° ì°¨ê°:', generalBudget, 'â†’', newGeneralBudget);
          } else if (formData.account === 'íšŒë¹„') {
            const newMembershipFee = membershipFee - parseInt(formData.amount);
            setMembershipFee(newMembershipFee);
            updateSettingInSupabase('membership_fee', newMembershipFee);
            console.log('âœ… íšŒë¹„ ì°¨ê°:', membershipFee, 'â†’', newMembershipFee);
          } else if (formData.account === 'ì°¬ì¡°ê¸ˆ') {
            const newDonations = donations - parseInt(formData.amount);
            setDonations(newDonations);
            updateSettingInSupabase('donations', newDonations);
            console.log('âœ… ì°¬ì¡°ê¸ˆ ì°¨ê°:', donations, 'â†’', newDonations);
          }

          await saveExpenseToSupabase(newExpense);
          setExpenses([newExpense, ...expenses]);

          setFormData({
            date: new Date().toISOString().split('T')[0],
            amount: '',
            category: 'ì°¬ì–‘íŒ€ ì‹ì‚¬',
            memo: '',
            account: 'ì¼ë°˜ ì˜ˆì‚°',
            receipts: []
          });
          setShowAddForm(false);
        } catch (error) {
          alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
      };

      const deleteExpense = async (id) => {
        if (window.confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          try {
            const target = expenses.find(exp => exp.id === id);

            console.log('ğŸ—‘ï¸ ì§€ì¶œ ì‚­ì œ - ì˜ˆì‚° ë³µì›:', {
              ì¶œì²˜: target.account,
              ê¸ˆì•¡: target.amount
            });

            // í•´ë‹¹ ì¶œì²˜ì˜ ì˜ˆì‚° ë³µì› (ë…ë¦½ì  ê´€ë¦¬)
            if (target.account === 'ì¼ë°˜ ì˜ˆì‚°') {
              const newGeneralBudget = generalBudget + target.amount;
              setGeneralBudget(newGeneralBudget);
              updateSettingInSupabase('general_budget', newGeneralBudget);
              console.log('âœ… ì¼ë°˜ ì˜ˆì‚° ë³µì›:', generalBudget, 'â†’', newGeneralBudget);
            } else if (target.account === 'íšŒë¹„') {
              const newMembershipFee = membershipFee + target.amount;
              setMembershipFee(newMembershipFee);
              updateSettingInSupabase('membership_fee', newMembershipFee);
              console.log('âœ… íšŒë¹„ ë³µì›:', membershipFee, 'â†’', newMembershipFee);
            } else if (target.account === 'ì°¬ì¡°ê¸ˆ') {
              const newDonations = donations + target.amount;
              setDonations(newDonations);
              updateSettingInSupabase('donations', newDonations);
              console.log('âœ… ì°¬ì¡°ê¸ˆ ë³µì›:', donations, 'â†’', newDonations);
            }

            // ì˜ìˆ˜ì¦ ì‚­ì œ
            if (target.receipts && target.receipts.length > 0) {
              for (const fileName of target.receipts) {
                await deleteReceiptFromSupabase(fileName);
              }
            }

            await deleteExpenseFromSupabase(id);
            setExpenses(expenses.filter(e => e.id !== id));
          } catch (error) {
            alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
          }
        }
      };

      const clearAllData = () => {
        if (window.confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në°±ì—…í•˜ì§€ ì•Šì€ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
          if (window.confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë‘ ë²ˆì§¸ í™•ì¸)')) {
            localStorage.removeItem('accounting_2026_v2');
            setExpenses([]);
            setGeneralBudget(INITIAL_GENERAL_BUDGET);
            setDonations(INITIAL_DONATIONS);
            setMembershipFee(INITIAL_MEMBERSHIP);
            setMembershipList([]);
            setDonationsList([]);
            alert('âœ… ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          }
        }
      };

      const openReceipt = (fileName) => {
        try {
          const publicUrl = getReceiptUrlFromSupabase(fileName);
          setViewingReceipt(publicUrl);
        } catch (error) {
          console.error('ì˜ìˆ˜ì¦ ë¡œë“œ ì—ëŸ¬:', error);
          alert('ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
        }
      };

      // ì§€ì¶œ ìˆ˜ì • ì·¨ì†Œ - ëª¨ë‹¬ë§Œ ë‹«ê¸° (ë³µì› ì‘ì—… ì—†ìŒ)
      const cancelEditExpense = () => {
        console.log('âŒ ìˆ˜ì • ì·¨ì†Œ');
        setEditingExpense(null);
        setFormData({
          date: new Date().toISOString().split('T')[0],
          amount: '',
          category: 'ì°¬ì–‘íŒ€ ì‹ì‚¬',
          memo: '',
          account: 'ì¼ë°˜ ì˜ˆì‚°',
          receipts: []
        });
      };

      // ì§€ì¶œ ìˆ˜ì • ì‹œì‘ - ëª¨ë‹¬ë§Œ ì—´ê¸° (ë³µì›ì€ ì €ì¥ ì‹œì ì— ì²˜ë¦¬)
      const startEditExpense = (expense) => {
        console.log('ğŸ”„ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°:', {
          ê¸°ì¡´ì¶œì²˜: expense.account,
          ê¸ˆì•¡: expense.amount,
          í˜„ì¬ì¼ë°˜ì˜ˆì‚°: generalBudget,
          í˜„ì¬íšŒë¹„: membershipFee,
          í˜„ì¬ì°¬ì¡°ê¸ˆ: donations
        });

        setEditingExpense(expense);
        setFormData({
          date: expense.date,
          amount: expense.amount.toString(),
          category: expense.category,
          memo: expense.memo || '',
          account: expense.account || 'ì¼ë°˜ ì˜ˆì‚°',
          receipts: []
        });
      };

      // ì§€ì¶œ ìˆ˜ì • ì œì¶œ - ë³µì› + ì°¨ê° í†µí•© ì²˜ë¦¬
      const handleEditSubmit = async (e) => {
        e.preventDefault();
        try {
          const receiptFileNames = [...(editingExpense.receipts || [])];

          // ìƒˆ ì˜ìˆ˜ì¦ ì—…ë¡œë“œ
          for (let i = 0; i < formData.receipts.length; i++) {
            if (receiptFileNames.length < 5) {
              const fileName = await uploadReceiptToSupabase(editingExpense.id, formData.receipts[i], receiptFileNames.length);
              receiptFileNames.push(fileName);
            }
          }

          const oldAccount = editingExpense.account;
          const oldAmount = editingExpense.amount;
          const newAccount = formData.account;
          const newAmount = parseInt(formData.amount);

          console.log('ğŸ’¾ ìˆ˜ì • ì €ì¥ - ì˜ˆì‚° ì¬ê³„ì‚°:', {
            'ê¸°ì¡´': `${oldAccount} ${oldAmount}ì›`,
            'ìƒˆë¡œìš´': `${newAccount} ${newAmount}ì›`,
            'í˜„ì¬ ì¼ë°˜ì˜ˆì‚°': generalBudget,
            'í˜„ì¬ íšŒë¹„': membershipFee,
            'í˜„ì¬ ì°¬ì¡°ê¸ˆ': donations
          });

          // 1ë‹¨ê³„: ê¸°ì¡´ ì¶œì²˜ì— ê¸ˆì•¡ ë³µì›
          let updatedGeneralBudget = generalBudget;
          let updatedMembershipFee = membershipFee;
          let updatedDonations = donations;

          if (oldAccount === 'ì¼ë°˜ ì˜ˆì‚°') {
            updatedGeneralBudget += oldAmount;
            console.log('ğŸ”„ [ë³µì›] ì¼ë°˜ ì˜ˆì‚°:', generalBudget, 'â†’', updatedGeneralBudget);
          } else if (oldAccount === 'íšŒë¹„') {
            updatedMembershipFee += oldAmount;
            console.log('ğŸ”„ [ë³µì›] íšŒë¹„:', membershipFee, 'â†’', updatedMembershipFee);
          } else if (oldAccount === 'ì°¬ì¡°ê¸ˆ') {
            updatedDonations += oldAmount;
            console.log('ğŸ”„ [ë³µì›] ì°¬ì¡°ê¸ˆ:', donations, 'â†’', updatedDonations);
          }

          // 2ë‹¨ê³„: ìƒˆ ì¶œì²˜ì—ì„œ ê¸ˆì•¡ ì°¨ê°
          if (newAccount === 'ì¼ë°˜ ì˜ˆì‚°') {
            updatedGeneralBudget -= newAmount;
            console.log('ğŸ’° [ì°¨ê°] ì¼ë°˜ ì˜ˆì‚°:', updatedGeneralBudget + newAmount, 'â†’', updatedGeneralBudget);
          } else if (newAccount === 'íšŒë¹„') {
            updatedMembershipFee -= newAmount;
            console.log('ğŸ’° [ì°¨ê°] íšŒë¹„:', updatedMembershipFee + newAmount, 'â†’', updatedMembershipFee);
          } else if (newAccount === 'ì°¬ì¡°ê¸ˆ') {
            updatedDonations -= newAmount;
            console.log('ğŸ’° [ì°¨ê°] ì°¬ì¡°ê¸ˆ:', updatedDonations + newAmount, 'â†’', updatedDonations);
          }

          // 3ë‹¨ê³„: State ë° Supabase ì—…ë°ì´íŠ¸
          setGeneralBudget(updatedGeneralBudget);
          setMembershipFee(updatedMembershipFee);
          setDonations(updatedDonations);

          updateSettingInSupabase('general_budget', updatedGeneralBudget);
          updateSettingInSupabase('membership_fee', updatedMembershipFee);
          updateSettingInSupabase('donations', updatedDonations);

          console.log('âœ… ìµœì¢… ê²°ê³¼:', {
            ì¼ë°˜ì˜ˆì‚°: updatedGeneralBudget,
            íšŒë¹„: updatedMembershipFee,
            ì°¬ì¡°ê¸ˆ: updatedDonations
          });

          const updatedExpense = {
            ...editingExpense,
            date: formData.date,
            amount: newAmount,
            category: formData.category,
            memo: formData.memo,
            account: newAccount,
            receipts: receiptFileNames
          };

          await updateExpenseInSupabase(updatedExpense);
          setExpenses(expenses.map(exp =>
            exp.id === editingExpense.id ? updatedExpense : exp
          ));

          setEditingExpense(null);
          setFormData({
            date: new Date().toISOString().split('T')[0],
            amount: '',
            category: 'ì°¬ì–‘íŒ€ ì‹ì‚¬',
            memo: '',
            account: 'ì¼ë°˜ ì˜ˆì‚°',
            receipts: []
          });

          console.log('âœ… ìˆ˜ì • ì™„ë£Œ - ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ìë™ ì—…ë°ì´íŠ¸');
          alert('âœ… ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } catch (error) {
          console.error('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜:', error);
          alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
      };

      // íšŒë¹„ ë‚©ë¶€ ì¶”ê°€
      const handleMembershipSubmit = (e) => {
        e.preventDefault();
        const newEntry = {
          id: Date.now(),
          ...membershipFormData,
          amount: parseInt(membershipFormData.amount)
        };

        const newMembershipList = [...membershipList, newEntry];
        setMembershipList(newMembershipList);

        const newTotal = membershipFee + parseInt(membershipFormData.amount);
        setMembershipFee(newTotal);
        updateSettingInSupabase('membership_fee', newTotal);

        setMembershipFormData({
          date: new Date().toISOString().split('T')[0],
          name: '',
          amount: '',
          memo: ''
        });
        setShowMembershipForm(false);
      };

      // ì°¬ì¡°ê¸ˆ ì¶”ê°€
      const handleDonationsSubmit = (e) => {
        e.preventDefault();
        const newEntry = {
          id: Date.now(),
          ...donationsFormData,
          amount: parseInt(donationsFormData.amount)
        };

        const newDonationsList = [...donationsList, newEntry];
        setDonationsList(newDonationsList);

        const newTotal = donations + parseInt(donationsFormData.amount);
        setDonations(newTotal);
        updateSettingInSupabase('donations', newTotal);

        setDonationsFormData({
          date: new Date().toISOString().split('T')[0],
          name: '',
          amount: '',
          memo: ''
        });
        setShowDonationsForm(false);
      };

      const exportData = () => {
        const data = { expenses, generalBudget, donations, membershipFee, membershipList, donationsList };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `íšŒê³„ë°ì´í„°_2026_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
      };

      const importData = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = JSON.parse(e.target.result);
              setExpenses(data.expenses || []);
              setGeneralBudget(data.generalBudget || INITIAL_GENERAL_BUDGET);
              setDonations(data.donations || INITIAL_DONATIONS);
              setMembershipFee(data.membershipFee || INITIAL_MEMBERSHIP);
              setMembershipList(data.membershipList || []);
              setDonationsList(data.donationsList || []);
              alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
            } catch (err) {
              alert('ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
            }
          };
          reader.readAsText(file);
        }
      };

      // ëŒ€ì‹œë³´ë“œ í•©ê³„ ê³„ì‚° (í˜„ì¬ State ê¸°ë°˜ - ëª…í™•í•œ ë…ë¦½ì„±)

      // 1. ì´ ì§€ì¶œ: expenses ë°°ì—´ì˜ ì‹¤ì œ í•©ê³„ (ë‹¨ì¼ ì§„ì‹¤ì˜ ì›ì²œ)
      const totalSpent = expenses.reduce((sum, e) => sum + e.amount, 0);

      // 2. ì´ ì˜ˆì‚°: ì´ˆê¸°ê°’ë“¤ì˜ í•© (ê³ ì •ê°’)
      const totalBudget = INITIAL_GENERAL_BUDGET + INITIAL_MEMBERSHIP + INITIAL_DONATIONS;

      // 3. ë‚¨ì€ ì˜ˆì‚°: í˜„ì¬ ê° í•­ëª©ì˜ ì”ì•¡ ìˆœìˆ˜ í•©ê³„ (ì‹¤ì‹œê°„ ë…ë¦½ ë°˜ì˜)
      //    - ì¼ë°˜ ì˜ˆì‚°ì—ì„œ ì§€ì¶œ ì‹œ: generalBudgetë§Œ ê°ì†Œ â†’ remainingBudget ê°ì†Œ
      //    - íšŒë¹„ì—ì„œ ì§€ì¶œ ì‹œ: membershipFeeë§Œ ê°ì†Œ â†’ remainingBudget ê°ì†Œ
      //    - ì°¬ì¡°ê¸ˆì—ì„œ ì§€ì¶œ ì‹œ: donationsë§Œ ê°ì†Œ â†’ remainingBudget ê°ì†Œ
      const remainingBudget = generalBudget + membershipFee + donations;

      // í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•œ ë³€ìˆ˜
      const totalExpenses = totalSpent;

      const monthlyStats = Array.from({ length: 12 }, (_, i) => {
        const month = i + 1;
        const monthExpenses = expenses.filter(e => {
          const expenseMonth = new Date(e.date).getMonth() + 1;
          return expenseMonth === month;
        });
        return {
          month,
          total: monthExpenses.reduce((sum, e) => sum + e.amount, 0),
          count: monthExpenses.length
        };
      });

      const currentMonthExpenses = expenses.filter(e => {
        const expenseMonth = new Date(e.date).getMonth() + 1;
        return expenseMonth === selectedMonth;
      });

      return (
        <div style={{
          minHeight: '100vh',
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          padding: '16px',
        }}>
          <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
            {/* Header */}
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              marginBottom: '20px',
              flexWrap: 'wrap',
              gap: '12px'
            }}>
              <div>
                <h1 style={{
                  fontSize: '28px',
                  fontWeight: '900',
                  color: '#fff',
                  margin: '0 0 4px 0',
                  fontFamily: "'Orbitron', monospace"
                }}>
                  2026 íšŒê³„ ê´€ë¦¬ V2
                </h1>
                <p style={{ color: 'rgba(255,255,255,0.9)', margin: 0, fontSize: '14px' }}>
                  ê³ ë„í™” ë²„ì „ Â· ì¶œì²˜ ì¶”ì  Â· ë‹¤ì¤‘ ì˜ìˆ˜ì¦
                </p>
              </div>
              <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                <button className="btn btn-primary" onClick={() => setShowAddForm(true)}>
                  <Icon type="plus" size={18} /> ì¶”ê°€
                </button>
                <button className="btn" style={{ background: 'white', color: '#1f2937', padding: '10px 16px' }} onClick={exportData}>
                  <Icon type="download" size={18} />
                </button>
                <label className="btn" style={{ background: 'white', color: '#1f2937', cursor: 'pointer', padding: '10px 16px' }}>
                  <Icon type="upload" size={18} />
                  <input type="file" accept=".json" onChange={importData} style={{ display: 'none' }} />
                </label>
                <button
                  className="btn"
                  style={{ background: '#ef4444', color: 'white', padding: '10px 16px' }}
                  onClick={clearAllData}
                  title="ëª¨ë“  ë°ì´í„° ì‚­ì œ"
                >
                  <Icon type="trash" size={18} />
                </button>
              </div>
            </div>

            {/* Navigation */}
            <div style={{ display: 'flex', gap: '8px', marginBottom: '16px', flexWrap: 'wrap' }}>
              {[
                { mode: 'dashboard', label: 'ğŸ“Š ëŒ€ì‹œë³´ë“œ' },
                { mode: 'list', label: 'ğŸ“‹ ë‚´ì—­' },
                { mode: 'monthly', label: 'ğŸ“… ì›”ë³„' },
                { mode: 'people', label: 'ğŸ‘¥ ëª…ë‹¨' }
              ].map(({ mode, label }) => (
                <button
                  key={mode}
                  className="btn"
                  onClick={() => setViewMode(mode)}
                  style={{
                    background: viewMode === mode ? 'white' : 'rgba(255,255,255,0.2)',
                    color: viewMode === mode ? '#667eea' : 'white',
                    fontWeight: viewMode === mode ? '700' : '600',
                    padding: '10px 20px',
                    fontSize: '14px'
                  }}
                >
                  {label}
                </button>
              ))}
            </div>

            {/* Dashboard View */}
            {viewMode === 'dashboard' && (
              <>
                {/* Summary Cards */}
                <div className="stat-grid">
                  <div className="card" style={{
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    color: 'white',
                    padding: '16px'
                  }}>
                    <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '4px' }}>ì´ ì˜ˆì‚°</div>
                    <div className="number-display" style={{ fontSize: '24px' }}>
                      {formatNumber(totalBudget)}ì›
                    </div>
                  </div>

                  <div className="card" style={{
                    background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    color: 'white',
                    padding: '16px'
                  }}>
                    <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '4px' }}>ì´ ì§€ì¶œ</div>
                    <div className="number-display" style={{ fontSize: '24px' }}>
                      {formatNumber(totalExpenses)}ì›
                    </div>
                    <div style={{ fontSize: '11px', opacity: 0.8 }}>
                      {expenses.length}ê±´
                    </div>
                  </div>

                  <div className="card" style={{
                    background: remainingBudget >= 0
                      ? 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
                      : 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                    color: 'white',
                    padding: '16px'
                  }}>
                    <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '4px' }}>
                      ë‚¨ì€ì˜ˆì‚°
                    </div>
                    <div className="number-display" style={{ fontSize: '24px' }}>
                      {formatNumber(Math.abs(remainingBudget))}ì›
                    </div>
                  </div>
                </div>

                {/* í•­ëª©ë³„ ë…ë¦½ ì˜ˆì‚° ì¹´ë“œ (3ê°œ ë…ë¦½ í•­ëª©) */}
                <div className="stat-grid">
                  <div className="card" style={{
                    background: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                    color: '#1f2937',
                    padding: '16px',
                    border: '2px solid rgba(255,255,255,0.3)'
                  }}>
                    <div style={{ fontSize: '12px', opacity: 0.7, marginBottom: '4px', fontWeight: '600' }}>ì¼ë°˜ ì˜ˆì‚°</div>
                    <div className="number-display" style={{ fontSize: '24px', fontWeight: '700' }}>
                      {formatNumber(generalBudget)}ì›
                    </div>
                    <div style={{ fontSize: '11px', opacity: 0.6 }}>
                      ì´ˆê¸° 3,200,000ì›
                    </div>
                  </div>

                  <div className="card" style={{
                    background: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    color: 'white',
                    padding: '16px'
                  }}>
                    <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '4px' }}>íšŒë¹„</div>
                    <div className="number-display" style={{ fontSize: '24px' }}>
                      {formatNumber(membershipFee)}ì›
                    </div>
                    <div style={{ fontSize: '11px', opacity: 0.8 }}>
                      ì´ˆê¸° 496,000ì› Â· {membershipList.length}ê±´
                    </div>
                  </div>

                  <div className="card" style={{
                    background: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                    color: 'white',
                    padding: '16px'
                  }}>
                    <div style={{ fontSize: '12px', opacity: 0.9, marginBottom: '4px' }}>ì°¬ì¡°ê¸ˆ</div>
                    <div className="number-display" style={{ fontSize: '24px' }}>
                      {formatNumber(donations)}ì›
                    </div>
                    <div style={{ fontSize: '11px', opacity: 0.8 }}>
                      ì´ˆê¸° 11,133ì› Â· {donationsList.length}ê±´
                    </div>
                  </div>
                </div>

                {/* Monthly Overview */}
                <div className="card">
                  <h3 style={{ margin: '0 0 16px 0', fontSize: '16px', fontWeight: '600' }}>
                    ì›”ë³„ ì§€ì¶œ í˜„í™©
                  </h3>
                  <div style={{ display: 'grid', gap: '8px' }}>
                    {monthlyStats.filter(m => m.total > 0).map(stat => (
                      <div key={stat.month} className="month-item">
                        <div>
                          <div style={{ fontWeight: '600', fontSize: '14px' }}>
                            {stat.month}ì›”
                          </div>
                          <div style={{ fontSize: '12px', color: '#6b7280' }}>
                            {stat.count}ê±´
                          </div>
                        </div>
                        <div className="number-display" style={{ fontSize: '18px', fontWeight: '700', color: '#667eea' }}>
                          {formatNumber(stat.total)}ì›
                        </div>
                      </div>
                    ))}
                    {monthlyStats.filter(m => m.total > 0).length === 0 && (
                      <div style={{ textAlign: 'center', padding: '20px', color: '#9ca3af' }}>
                        ì•„ì§ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤
                      </div>
                    )}
                  </div>
                </div>
              </>
            )}

            {/* List View */}
            {viewMode === 'list' && (
              <div className="card">
                <h3 style={{ margin: '0 0 16px 0', fontSize: '18px', fontWeight: '600' }}>
                  ì „ì²´ ì§€ì¶œ ({expenses.length}ê±´)
                </h3>
                {expenses.length === 0 ? (
                  <div style={{ textAlign: 'center', padding: '40px', color: '#9ca3af' }}>
                    ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤
                  </div>
                ) : (
                  <div style={{ display: 'grid', gap: '12px' }}>
                    {expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).map(expense => (
                      <div key={expense.id} style={{
                        padding: '12px',
                        background: '#f9fafb',
                        borderRadius: '12px'
                      }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px', flexWrap: 'wrap', gap: '8px' }}>
                          <div>
                            <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>
                              {expense.date} Â· {expense.account || 'ì¼ë°˜ ì˜ˆì‚°'}
                            </div>
                            <div style={{ fontSize: '18px', fontWeight: '700', color: '#1f2937' }}>
                              {formatNumber(expense.amount)}ì›
                            </div>
                            <div style={{ fontSize: '12px', color: '#6b7280', marginTop: '2px' }}>
                              {expense.category}
                            </div>
                          </div>
                          <div style={{ display: 'flex', gap: '8px', alignItems: 'flex-start' }}>
                            {expense.receipts && expense.receipts.length > 0 && (
                              <button
                                className="btn"
                                style={{ padding: '6px 12px', background: '#f3f4f6', color: '#1f2937', fontSize: '12px' }}
                                onClick={() => openReceipt(expense.receipts[0])}
                                title="ì˜ìˆ˜ì¦ ë³´ê¸°"
                              >
                                <Icon type="eye" size={14} /> {expense.receipts.length}
                              </button>
                            )}
                            <button
                              className="btn"
                              style={{ padding: '6px 12px', background: '#667eea', color: 'white', fontSize: '12px' }}
                              onClick={() => startEditExpense(expense)}
                              title="ìˆ˜ì •"
                            >
                              âœï¸
                            </button>
                            <button
                              className="btn btn-danger"
                              style={{ padding: '6px 12px', fontSize: '12px' }}
                              onClick={() => deleteExpense(expense.id)}
                              title="ì‚­ì œ"
                            >
                              <Icon type="trash" size={14} />
                            </button>
                          </div>
                        </div>
                        {expense.memo && (
                          <div style={{ fontSize: '13px', color: '#6b7280' }}>{expense.memo}</div>
                        )}
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* Monthly View */}
            {viewMode === 'monthly' && (
              <>
                <div className="card" style={{ marginBottom: '16px' }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: '600' }}>ì›”ë³„ ìƒì„¸</h3>
                    <select
                      value={selectedMonth}
                      onChange={(e) => setSelectedMonth(parseInt(e.target.value))}
                      className="input-field"
                      style={{ width: 'auto', padding: '8px 16px' }}
                    >
                      {Array.from({ length: 12 }, (_, i) => i + 1).map(m => (
                        <option key={m} value={m}>{m}ì›”</option>
                      ))}
                    </select>
                  </div>
                </div>

                <div className="card">
                  <div style={{
                    padding: '16px',
                    background: 'linear-gradient(135deg, #667eea22 0%, #764ba222 100%)',
                    borderRadius: '12px',
                    marginBottom: '16px'
                  }}>
                    <div style={{ fontSize: '13px', color: '#6b7280', marginBottom: '6px' }}>
                      {selectedMonth}ì›” ì´ ì§€ì¶œ
                    </div>
                    <div className="number-display" style={{ fontSize: '28px', fontWeight: '700', color: '#1f2937' }}>
                      {formatNumber(currentMonthExpenses.reduce((sum, e) => sum + e.amount, 0))}ì›
                    </div>
                  </div>

                  {currentMonthExpenses.length === 0 ? (
                    <div style={{ textAlign: 'center', padding: '40px', color: '#9ca3af' }}>
                      {selectedMonth}ì›” ì§€ì¶œ ì—†ìŒ
                    </div>
                  ) : (
                    <div style={{ display: 'grid', gap: '12px' }}>
                      {currentMonthExpenses.sort((a, b) => new Date(b.date) - new Date(a.date)).map(expense => (
                        <div key={expense.id} style={{
                          padding: '12px',
                          background: '#f9fafb',
                          borderRadius: '12px'
                        }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px', flexWrap: 'wrap', gap: '8px' }}>
                            <div>
                              <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>
                                {expense.date} Â· {expense.account || 'ì¼ë°˜ ì˜ˆì‚°'}
                              </div>
                              <div style={{ fontSize: '18px', fontWeight: '700', color: '#1f2937' }}>
                                {formatNumber(expense.amount)}ì›
                              </div>
                              <div style={{ fontSize: '12px', color: '#6b7280', marginTop: '2px' }}>
                                {expense.category}
                              </div>
                            </div>
                            <div style={{ display: 'flex', gap: '8px', alignItems: 'flex-start' }}>
                              {expense.receipts && expense.receipts.length > 0 && (
                                <button
                                  className="btn"
                                  style={{ padding: '6px 12px', background: '#f3f4f6', color: '#1f2937', fontSize: '12px' }}
                                  onClick={() => openReceipt(expense.receipts[0])}
                                  title="ì˜ìˆ˜ì¦ ë³´ê¸°"
                                >
                                  <Icon type="eye" size={14} /> {expense.receipts.length}
                                </button>
                              )}
                              <button
                                className="btn"
                                style={{ padding: '6px 12px', background: '#667eea', color: 'white', fontSize: '12px' }}
                                onClick={() => startEditExpense(expense)}
                                title="ìˆ˜ì •"
                              >
                                âœï¸
                              </button>
                              <button
                                className="btn btn-danger"
                                style={{ padding: '6px 12px', fontSize: '12px' }}
                                onClick={() => deleteExpense(expense.id)}
                                title="ì‚­ì œ"
                              >
                                <Icon type="trash" size={14} />
                              </button>
                            </div>
                          </div>
                          {expense.memo && (
                            <div style={{ fontSize: '13px', color: '#6b7280' }}>{expense.memo}</div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </>
            )}

            {/* People (ëª…ë‹¨) View */}
            {viewMode === 'people' && (
              <>
                <div className="card">
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: '600' }}>íšŒë¹„ ë‚©ë¶€ ëª…ë‹¨</h3>
                    <button className="btn btn-primary" onClick={() => setShowMembershipForm(true)} style={{ padding: '8px 16px' }}>
                      <Icon type="plus" size={16} /> ì¶”ê°€
                    </button>
                  </div>
                  {membershipList.length === 0 ? (
                    <div style={{ textAlign: 'center', padding: '20px', color: '#9ca3af' }}>
                      íšŒë¹„ ë‚©ë¶€ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤
                    </div>
                  ) : (
                    <div style={{ display: 'grid', gap: '8px' }}>
                      {membershipList.sort((a, b) => new Date(b.date) - new Date(a.date)).map(item => (
                        <div key={item.id} style={{
                          padding: '12px',
                          background: '#f9fafb',
                          borderRadius: '12px',
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center'
                        }}>
                          <div>
                            <div style={{ fontSize: '14px', fontWeight: '600' }}>{item.name}</div>
                            <div style={{ fontSize: '12px', color: '#6b7280' }}>{item.date}</div>
                            {item.memo && <div style={{ fontSize: '12px', color: '#6b7280' }}>{item.memo}</div>}
                          </div>
                          <div className="number-display" style={{ fontSize: '16px', fontWeight: '700', color: '#667eea' }}>
                            {formatNumber(item.amount)}ì›
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>

                <div className="card">
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>
                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: '600' }}>ì°¬ì¡°ê¸ˆ ëª…ë‹¨</h3>
                    <button className="btn btn-primary" onClick={() => setShowDonationsForm(true)} style={{ padding: '8px 16px' }}>
                      <Icon type="plus" size={16} /> ì¶”ê°€
                    </button>
                  </div>
                  {donationsList.length === 0 ? (
                    <div style={{ textAlign: 'center', padding: '20px', color: '#9ca3af' }}>
                      ì°¬ì¡°ê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤
                    </div>
                  ) : (
                    <div style={{ display: 'grid', gap: '8px' }}>
                      {donationsList.sort((a, b) => new Date(b.date) - new Date(a.date)).map(item => (
                        <div key={item.id} style={{
                          padding: '12px',
                          background: '#f9fafb',
                          borderRadius: '12px',
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center'
                        }}>
                          <div>
                            <div style={{ fontSize: '14px', fontWeight: '600' }}>{item.name}</div>
                            <div style={{ fontSize: '12px', color: '#6b7280' }}>{item.date}</div>
                            {item.memo && <div style={{ fontSize: '12px', color: '#6b7280' }}>{item.memo}</div>}
                          </div>
                          <div className="number-display" style={{ fontSize: '16px', fontWeight: '700', color: '#667eea' }}>
                            {formatNumber(item.amount)}ì›
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </>
            )}

            {/* Add Expense Modal */}
            {showAddForm && (
              <div className="modal-overlay" onClick={() => setShowAddForm(false)}>
                <div className="modal" onClick={(e) => e.stopPropagation()}>
                  <h2 style={{ margin: '0 0 20px 0', fontSize: '22px', fontWeight: '700' }}>
                    ì§€ì¶œ ì¶”ê°€
                  </h2>
                  <form onSubmit={handleSubmit}>
                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ë‚ ì§œ
                      </label>
                      <input
                        type="date"
                        value={formData.date}
                        onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                        className="input-field"
                        required
                      />
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ê¸ˆì•¡ (ì›)
                      </label>
                      <input
                        type="text"
                        value={formatNumber(formData.amount)}
                        onChange={(e) => {
                          const numericValue = parseNumber(e.target.value);
                          if (numericValue === '' || /^\d+$/.test(numericValue)) {
                            setFormData({ ...formData, amount: numericValue });
                          }
                        }}
                        className="input-field"
                        placeholder="50,000"
                        required
                      />
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ì¶œì²˜ (Account)
                      </label>
                      <select
                        value={formData.account}
                        onChange={(e) => setFormData({ ...formData, account: e.target.value })}
                        className="input-field"
                        required
                      >
                        <option value="ì¼ë°˜ ì˜ˆì‚°">ì¼ë°˜ ì˜ˆì‚°</option>
                        <option value="íšŒë¹„">íšŒë¹„</option>
                        <option value="ì°¬ì¡°ê¸ˆ">ì°¬ì¡°ê¸ˆ</option>
                      </select>
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ì¹´í…Œê³ ë¦¬
                      </label>
                      <select
                        value={formData.category}
                        onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                        className="input-field"
                        required
                      >
                        <option value="ì°¬ì–‘íŒ€ ì‹ì‚¬">ì°¬ì–‘íŒ€ ì‹ì‚¬</option>
                        <option value="MT">MT</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        <option value="ì˜ˆë¹„ë¹„">ì˜ˆë¹„ë¹„</option>
                      </select>
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ë©”ëª¨
                      </label>
                      <textarea
                        value={formData.memo}
                        onChange={(e) => setFormData({ ...formData, memo: e.target.value })}
                        className="input-field"
                        rows="2"
                        placeholder="ì˜ˆ) 10ëª… ì‹ì‚¬"
                      />
                    </div>

                    <div style={{ marginBottom: '20px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ì˜ìˆ˜ì¦ ì‚¬ì§„ (ìµœëŒ€ 5ì¥)
                      </label>
                      <input
                        type="file"
                        accept="image/*"
                        multiple
                        onChange={handleImageUpload}
                        className="input-field"
                        style={{ padding: '8px' }}
                      />
                      {formData.receipts.length > 0 && (
                        <div className="receipt-preview-grid">
                          {formData.receipts.map((receipt, index) => (
                            <div key={index} className="receipt-preview-item">
                              <img src={receipt} alt={`ì˜ìˆ˜ì¦ ${index + 1}`} />
                              <button
                                type="button"
                                className="receipt-remove-btn"
                                onClick={() => removeReceipt(index)}
                              >
                                Ã—
                              </button>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>

                    <div style={{ display: 'flex', gap: '12px' }}>
                      <button type="submit" className="btn btn-primary" style={{ flex: 1 }}>
                        ì¶”ê°€
                      </button>
                      <button
                        type="button"
                        className="btn"
                        style={{ flex: 1, background: '#f3f4f6', color: '#1f2937' }}
                        onClick={() => setShowAddForm(false)}
                      >
                        ì·¨ì†Œ
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}

            {/* Edit Expense Modal */}
            {editingExpense && (
              <div className="modal-overlay" onClick={cancelEditExpense}>
                <div className="modal" onClick={(e) => e.stopPropagation()}>
                  <h2 style={{ marginBottom: '20px', fontSize: '24px', fontWeight: '700' }}>ì§€ì¶œ ìˆ˜ì •</h2>
                  <form onSubmit={handleEditSubmit}>
                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ë‚ ì§œ
                      </label>
                      <input
                        type="date"
                        value={formData.date}
                        onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                        className="input-field"
                        required
                      />
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ê¸ˆì•¡ (ì›)
                      </label>
                      <input
                        type="text"
                        value={formatNumber(formData.amount)}
                        onChange={(e) => {
                          const numericValue = parseNumber(e.target.value);
                          if (numericValue === '' || /^\d+$/.test(numericValue)) {
                            setFormData({ ...formData, amount: numericValue });
                          }
                        }}
                        className="input-field"
                        placeholder="50,000"
                        required
                      />
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ì¶œì²˜ (Account)
                      </label>
                      <select
                        value={formData.account}
                        onChange={(e) => setFormData({ ...formData, account: e.target.value })}
                        className="input-field"
                        required
                      >
                        <option value="ì¼ë°˜ ì˜ˆì‚°">ì¼ë°˜ ì˜ˆì‚°</option>
                        <option value="íšŒë¹„">íšŒë¹„</option>
                        <option value="ì°¬ì¡°ê¸ˆ">ì°¬ì¡°ê¸ˆ</option>
                      </select>
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ì¹´í…Œê³ ë¦¬
                      </label>
                      <select
                        value={formData.category}
                        onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                        className="input-field"
                        required
                      >
                        <option>ì°¬ì–‘íŒ€ ì‹ì‚¬</option>
                        <option>ì•…ê¸° êµ¬ì…</option>
                        <option>ì•…ë³´/ìŒì›</option>
                        <option>ì¥ë¹„ ìœ ì§€ë³´ìˆ˜</option>
                        <option>í–‰ì‚¬ë¹„</option>
                        <option>ê¸°íƒ€</option>
                      </select>
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ë©”ëª¨
                      </label>
                      <textarea
                        value={formData.memo}
                        onChange={(e) => setFormData({ ...formData, memo: e.target.value })}
                        className="input-field"
                        rows="3"
                        placeholder="ê°„ë‹¨í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                      />
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>
                        ì˜ìˆ˜ì¦ ì‚¬ì§„ ì¶”ê°€ (ê¸°ì¡´: {editingExpense.receipts?.length || 0}ì¥)
                      </label>
                      <input
                        type="file"
                        accept="image/*"
                        multiple
                        onChange={handleImageUpload}
                        className="input-field"
                        style={{ padding: '8px' }}
                      />
                      {formData.receipts.length > 0 && (
                        <div className="receipt-preview-grid">
                          {formData.receipts.map((receipt, index) => (
                            <div key={index} className="receipt-preview-item">
                              <img src={receipt} alt={`ìƒˆ ì˜ìˆ˜ì¦ ${index + 1}`} />
                              <button
                                type="button"
                                className="receipt-remove-btn"
                                onClick={() => removeReceipt(index)}
                              >
                                Ã—
                              </button>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>

                    <div style={{ display: 'flex', gap: '12px' }}>
                      <button type="submit" className="btn btn-primary" style={{ flex: 1 }}>
                        ìˆ˜ì •
                      </button>
                      <button
                        type="button"
                        className="btn"
                        style={{ flex: 1, background: '#f3f4f6', color: '#1f2937' }}
                        onClick={cancelEditExpense}
                      >
                        ì·¨ì†Œ
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            )}

            {/* Membership Form Modal */}
            {showMembershipForm && (
              <div className="modal-overlay" onClick={() => setShowMembershipForm(false)}>
                <div className="modal" onClick={(e) => e.stopPropagation()}>
                  <h2 style={{ margin: '0 0 20px 0', fontSize: '22px', fontWeight: '700' }}>
                    íšŒë¹„ ë‚©ë¶€ ì¶”ê°€
                  </h2>
                  <form onSubmit={handleMembershipSubmit}>
                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>ë‚ ì§œ</label>
                      <input
                        type="date"
                        value={membershipFormData.date}
                        onChange={(e) => setMembershipFormData({ ...membershipFormData, date: e.target.value })}
                        className="input-field"
                        required
                      />
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>ì´ë¦„</label>
                      <input
                        type="text"
                        value={membershipFormData.name}
                        onChange={(e) => setMembershipFormData({ ...membershipFormData, name: e.target.value })}
                        className="input-field"
                        placeholder="í™ê¸¸ë™"
                        required
                      />
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>ê¸ˆì•¡ (ì›)</label>
                      <input
                        type="text"
                        value={formatNumber(membershipFormData.amount)}
                        onChange={(e) => {
                          const numericValue = parseNumber(e.target.value);
                          if (numericValue === '' || /^\d+$/.test(numericValue)) {
                            setMembershipFormData({ ...membershipFormData, amount: numericValue });
                          }
                        }}
                        className="input-field"
                        placeholder="10,000"
                        required
                      />
                    </div>

                    <div style={{ marginBottom: '20px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>ë¹„ê³ </label>
                      <textarea
                        value={membershipFormData.memo}
                        onChange={(e) => setMembershipFormData({ ...membershipFormData, memo: e.target.value })}
                        className="input-field"
                        rows="2"
                        placeholder="ë¹„ê³ ì‚¬í•­"
                      />
                    </div>

                    <div style={{ display: 'flex', gap: '12px' }}>
                      <button type="submit" className="btn btn-primary" style={{ flex: 1 }}>ì¶”ê°€</button>
                      <button type="button" className="btn" style={{ flex: 1, background: '#f3f4f6', color: '#1f2937' }} onClick={() => setShowMembershipForm(false)}>ì·¨ì†Œ</button>
                    </div>
                  </form>
                </div>
              </div>
            )}

            {/* Donations Form Modal */}
            {showDonationsForm && (
              <div className="modal-overlay" onClick={() => setShowDonationsForm(false)}>
                <div className="modal" onClick={(e) => e.stopPropagation()}>
                  <h2 style={{ margin: '0 0 20px 0', fontSize: '22px', fontWeight: '700' }}>
                    ì°¬ì¡°ê¸ˆ ì¶”ê°€
                  </h2>
                  <form onSubmit={handleDonationsSubmit}>
                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>ë‚ ì§œ</label>
                      <input
                        type="date"
                        value={donationsFormData.date}
                        onChange={(e) => setDonationsFormData({ ...donationsFormData, date: e.target.value })}
                        className="input-field"
                        required
                      />
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>ì´ë¦„</label>
                      <input
                        type="text"
                        value={donationsFormData.name}
                        onChange={(e) => setDonationsFormData({ ...donationsFormData, name: e.target.value })}
                        className="input-field"
                        placeholder="í™ê¸¸ë™"
                        required
                      />
                    </div>

                    <div style={{ marginBottom: '16px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>ê¸ˆì•¡ (ì›)</label>
                      <input
                        type="text"
                        value={formatNumber(donationsFormData.amount)}
                        onChange={(e) => {
                          const numericValue = parseNumber(e.target.value);
                          if (numericValue === '' || /^\d+$/.test(numericValue)) {
                            setDonationsFormData({ ...donationsFormData, amount: numericValue });
                          }
                        }}
                        className="input-field"
                        placeholder="50,000"
                        required
                      />
                    </div>

                    <div style={{ marginBottom: '20px' }}>
                      <label style={{ display: 'block', marginBottom: '6px', fontWeight: '600', fontSize: '14px' }}>ë‚´ìš©</label>
                      <textarea
                        value={donationsFormData.memo}
                        onChange={(e) => setDonationsFormData({ ...donationsFormData, memo: e.target.value })}
                        className="input-field"
                        rows="2"
                        placeholder="ê¸°ë¶€ ë‚´ìš©"
                      />
                    </div>

                    <div style={{ display: 'flex', gap: '12px' }}>
                      <button type="submit" className="btn btn-primary" style={{ flex: 1 }}>ì¶”ê°€</button>
                      <button type="button" className="btn" style={{ flex: 1, background: '#f3f4f6', color: '#1f2937' }} onClick={() => setShowDonationsForm(false)}>ì·¨ì†Œ</button>
                    </div>
                  </form>
                </div>
              </div>
            )}

            {/* Receipt View Modal */}
            {viewingReceipt && (
              <div className="modal-overlay" onClick={() => setViewingReceipt(null)}>
                <div
                  className="modal"
                  onClick={(e) => e.stopPropagation()}
                  style={{ maxWidth: '720px', padding: '16px' }}
                >
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: '700' }}>ì˜ìˆ˜ì¦</h3>
                    <button
                      className="btn"
                      style={{ padding: '6px 12px', background: '#f3f4f6', color: '#1f2937', fontSize: '12px' }}
                      onClick={() => setViewingReceipt(null)}
                    >
                      <Icon type="x" size={14} />
                    </button>
                  </div>
                  <img
                    src={viewingReceipt}
                    alt="ì˜ìˆ˜ì¦"
                    style={{ width: '100%', maxHeight: '70vh', objectFit: 'contain', borderRadius: '12px', background: '#f9fafb' }}
                  />
                  <button
                    className="btn btn-primary"
                    style={{ width: '100%', marginTop: '12px' }}
                    onClick={() => setViewingReceipt(null)}
                  >
                    ë‹«ê¸°
                  </button>
                </div>
              </div>
            )}

          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<AccountingApp />);
  </script>

  <script>
    const CACHE_BUST = 'v=20260109-1';
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register(`service-worker.js?${CACHE_BUST}`)
          .then(reg => console.log('Service Worker registered'))
          .catch(err => console.log('Service Worker registration failed'));
      });
    }
  </script>
</body>
</html>
